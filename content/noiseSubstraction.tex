To ressemble realistic observations, we take into account the resolution, small scale noises and foreground substractions. 
Two filters are applied on original density contrast $\delta$ to imitate the effects of noise substractions:

1. For small scale noises:

Import a cut off scale $k_c$ 
with a step function $H(k_c-k)$. 
For $k>k_c$, $H(k_c-k)=0$; for $k\leqslant k_x$; $H(k_c-k)=1$.
This is reasonable for a single dish experiment, which
has good brightness sensitivity and an exponetially growing noise at small 
scales.
We choose $k_c=0.5\ h/\mr{Mpc}$ and $0.32 h/\mr{Mpc}$ respectively for $z=1$ and $z=2$ , which corresponds
to $\ell\sim1150$. 
This is generally realistic, judging from ongoing 21 cm experiments like
CHIME \cite{2014SPIE.9145E..22B}\cite{2014SPIE.9145E..4VN}
and Tianlai \cite{2012IJMPS..12..256C}\cite{2015ApJ...798...40X}.

2. For foreground noises:

Use a high pass filter $W_{fs}(k_\parallel)=1-e^{-k_\parallel^2R_\parallel^2/2}$ to imitate the substraction. 
We choose 
$R_\parallel=15\ \mr{Mpc}/h$ for $z=1$ and $R_\parallel=8\ \mr{Mpc}/h$ for $z=2$, which gives
$W_{fs}=0.5$ at
$k_\parallel=0.08\ \mr{Mpc}/h$ and $0.15\ \mr{Mpc}/h$ respectively. 
%This is realistic according to the condition of current 21 cm observations 
%\cite{2013ApJ...763L..20M}\cite{Switzer13}.

The observed 21 cm field after noises subtraction is then given by 
\begin{eqnarray}
\label{eq:ns}
\delta_{ns}(\bm{k})=\delta(\bm{k})W_{fs}(k_\parallel)H(k_c-k),
\end{eqnarray}

With the noise filtered density contrast $\delta_{ns}$, we follow the procedure described in 
section \ref{sec:kszRecon} to generate a mock kSZ signal $\hat \Theta_{ns}$  
and calculate cross correlation $r_{\Theta\hat\Theta_{ns}}$.
